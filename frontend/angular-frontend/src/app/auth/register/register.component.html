<div class="register-container">
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
    <h2>Registro de Usuario</h2>

    <div class="form-group">
      <label for="nombreApellido">Nombre y Apellido:</label>
      <input
        type="text"
        id="nombreApellido"
        formControlName="nombreApellido"
        [class.invalid]="
          nombreApellido?.invalid &&
          (nombreApellido?.dirty || nombreApellido?.touched)
        "
      />
      @if (nombreApellido?.invalid && (nombreApellido?.dirty || nombreApellido?.touched)) {
        <div class="error-message">
          @if (nombreApellido?.errors?.['required']) {
            <small>El nombre es requerido.</small>
          }
          @if (nombreApellido?.errors?.['minlength']) {
            <small>Debe tener al menos 3 caracteres.</small>
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="username">Nombre de Usuario:</label>
      <input
        type="text"
        id="username"
        formControlName="username"
        [class.invalid]="
          username?.invalid && (username?.dirty || username?.touched)
        "
      />
      @if (username?.invalid && (username?.dirty || username?.touched)) {
        <div class="error-message">
          @if (username?.errors?.['required']) {
            <small>El nombre de usuario es requerido.</small>
          }
          @if (username?.errors?.['minlength']) {
            <small>Debe tener al menos 4 caracteres.</small>
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="email">Correo Electrónico:</label>
      <input
        type="email"
        id="email"
        formControlName="email"
        [class.invalid]="email?.invalid && (email?.dirty || email?.touched)"
      />
      @if (email?.invalid && (email?.dirty || email?.touched)) {
        <div class="error-message">
          @if (email?.errors?.['required']) {
            <small>El correo es requerido.</small>
          }
          @if (email?.errors?.['email']) {
            <small>Debe ser un correo válido.</small>
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="password">Contraseña:</label>
      <input
        type="password"
        id="password"
        formControlName="password"
        [class.invalid]="
          password?.invalid && (password?.dirty || password?.touched)
        "
      />
      @if (password?.invalid && (password?.dirty || password?.touched)) {
        <div class="error-message">
          @if (password?.errors?.['required']) {
            <small>La contraseña es requerida.</small>
          }
          @if (password?.errors?.['minlength']) {
            <small>Debe tener al menos 6 caracteres.</small>
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="confirmPassword">Confirmar Contraseña:</label>
      <input
        type="password"
        id="confirmPassword"
        formControlName="confirmPassword"
        [class.invalid]="
          (confirmPassword?.invalid &&
            (confirmPassword?.dirty || confirmPassword?.touched)) ||
          (registerForm.errors?.['passwordsNotMatching'] &&
            (confirmPassword?.dirty || confirmPassword?.touched))
        "
      />
      @if ((confirmPassword?.invalid && (confirmPassword?.dirty || confirmPassword?.touched)) ||
           (registerForm.errors?.['passwordsNotMatching'] && (confirmPassword?.dirty || confirmPassword?.touched))) {
        <div class="error-message">
          @if (confirmPassword?.errors?.['required']) {
            <small>La confirmación es requerida.</small>
          }
          @if (registerForm.errors?.['passwordsNotMatching'] && !confirmPassword?.errors?.['required']) {
            <small>Las contraseñas no coinciden.</small>
          }
        </div>
      }
    </div>

    <div class="form-group-captcha">
      <ngx-recaptcha2
        [siteKey]="siteKey"
        formControlName="recaptcha"
      ></ngx-recaptcha2>
      @if (recaptcha?.invalid && (recaptcha?.dirty || recaptcha?.touched)) {
        <div class="error-message">
          @if (recaptcha?.errors?.['required']) {
            <small>El ReCaptcha es requerido.</small>
          }
        </div>
      }
    </div>

    @if (apiError) {
      <div class="api-error-message">
        <small>{{ apiError }}</small>
      </div>
    }

    <button type="submit" [disabled]="registerForm.invalid">Registrarse</button>
  </form>
</div>